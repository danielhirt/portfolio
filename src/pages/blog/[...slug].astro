---
import { Image } from 'astro:assets';
import { type CollectionEntry, getCollection, render } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import FormattedDate from '../../components/FormattedDate.astro';

export async function getStaticPaths() {
	const posts = await getCollection('blog');
	return posts.map((post) => ({
		params: { slug: post.id },
		props: post,
	}));
}

type Props = CollectionEntry<'blog'>;

const post = Astro.props;
const { title, description, pubDate, updatedDate, heroImage, tags } = post.data;
const { Content } = await render(post);
---

<BaseLayout title={title} description={description}>
	<article class="max-w-2xl mx-auto px-4 py-12">
		<div class="tracer-box bg-bg-dark/60 backdrop-blur-md border border-gray-light/10 px-8 py-10 md:px-10 md:py-12">
			<header class="mb-8">
				<a href="/blog" class="text-sm font-mono text-accent-light hover:text-white transition-colors mb-4 inline-block">[back to blog]</a>
				<h1 class="text-2xl font-bold text-text-dark mb-2">{title}</h1>
				<p class="text-xs text-text-dark-muted font-mono mb-4">
					<FormattedDate date={pubDate} />
					{updatedDate && (
						<span class="italic ml-2">
							(Updated: <FormattedDate date={updatedDate} />)
						</span>
					)}
				</p>
				{tags && tags.length > 0 && (
					<div class="flex flex-wrap gap-2">
						{tags.map((tag) => (
							<span class="text-xs font-mono px-2 py-0.5 text-text-dark-muted border border-gray-dark/50">{tag}</span>
						))}
					</div>
				)}
			</header>

			{heroImage && (
				<div class="mb-8 overflow-hidden border border-gray-dark/50">
					<Image
						src={heroImage}
						alt={title}
						width={1200}
						height={675}
						class="w-full"
					/>
				</div>
			)}

			<div class="prose max-w-none">
				<Content />
			</div>
		</div>
	</article>
</BaseLayout>
